import{U as Z,u as T,q as U,ay as k,aq as $,ap as W,v as j,r as l,ai as C,X as N,az as S,aA as D,O as v,aB as J,aC as K,a2 as Q,R as x,at as Y,au as V}from"./index-67e32464.js";import{O as ee}from"./OrbitControls-dfbcc7a3.js";class te extends Z{constructor(m,h,i,P){super();const u=[],g=[],A=[],c=new T,O=new U;O.makeRotationFromEuler(i),O.setPosition(h);const I=new U;I.copy(O).invert(),B(),this.setAttribute("position",new k(u,3)),this.setAttribute("normal",new k(g,3)),this.setAttribute("uv",new k(A,2));function B(){let e,t=[];const r=new T,a=new T;if(m.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const n=m.geometry,w=n.attributes.position,b=n.attributes.normal;if(n.index!==null){const p=n.index;for(e=0;e<p.count;e++)r.fromBufferAttribute(w,p.getX(e)),a.fromBufferAttribute(b,p.getX(e)),M(t,r,a)}else for(e=0;e<w.count;e++)r.fromBufferAttribute(w,e),a.fromBufferAttribute(b,e),M(t,r,a);for(t=y(t,c.set(1,0,0)),t=y(t,c.set(-1,0,0)),t=y(t,c.set(0,1,0)),t=y(t,c.set(0,-1,0)),t=y(t,c.set(0,0,1)),t=y(t,c.set(0,0,-1)),e=0;e<t.length;e++){const p=t[e];A.push(.5+p.position.x/P.x,.5+p.position.y/P.y),p.position.applyMatrix4(O),u.push(p.position.x,p.position.y,p.position.z),g.push(p.normal.x,p.normal.y,p.normal.z)}}function M(e,t,r){t.applyMatrix4(m.matrixWorld),t.applyMatrix4(I),r.transformDirection(m.matrixWorld),e.push(new H(t.clone(),r.clone()))}function y(e,t){const r=[],a=.5*Math.abs(P.dot(t));for(let n=0;n<e.length;n+=3){let w,b,p,L=0,f,d,E,z;const X=e[n+0].position.dot(t)-a,_=e[n+1].position.dot(t)-a,q=e[n+2].position.dot(t)-a;switch(w=X>0,b=_>0,p=q>0,L=(w?1:0)+(b?1:0)+(p?1:0),L){case 0:{r.push(e[n]),r.push(e[n+1]),r.push(e[n+2]);break}case 1:{if(w&&(f=e[n+1],d=e[n+2],E=s(e[n],f,t,a),z=s(e[n],d,t,a)),b){f=e[n],d=e[n+2],E=s(e[n+1],f,t,a),z=s(e[n+1],d,t,a),r.push(E),r.push(d.clone()),r.push(f.clone()),r.push(d.clone()),r.push(E.clone()),r.push(z);break}p&&(f=e[n],d=e[n+1],E=s(e[n+2],f,t,a),z=s(e[n+2],d,t,a)),r.push(f.clone()),r.push(d.clone()),r.push(E),r.push(z),r.push(E.clone()),r.push(d.clone());break}case 2:{w||(f=e[n].clone(),d=s(f,e[n+1],t,a),E=s(f,e[n+2],t,a),r.push(f),r.push(d),r.push(E)),b||(f=e[n+1].clone(),d=s(f,e[n+2],t,a),E=s(f,e[n],t,a),r.push(f),r.push(d),r.push(E)),p||(f=e[n+2].clone(),d=s(f,e[n],t,a),E=s(f,e[n+1],t,a),r.push(f),r.push(d),r.push(E));break}}}return r}function s(e,t,r,a){const n=e.position.dot(r)-a,w=t.position.dot(r)-a,b=n/(n-w);return new H(new T(e.position.x+b*(t.position.x-e.position.x),e.position.y+b*(t.position.y-e.position.y),e.position.z+b*(t.position.z-e.position.z)),new T(e.normal.x+b*(t.normal.x-e.normal.x),e.normal.y+b*(t.normal.y-e.normal.y),e.normal.z+b*(t.normal.z-e.normal.z)))}}}class H{constructor(m,h){this.position=m,this.normal=h}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const R=o=>o===Object(o)&&!Array.isArray(o)&&typeof o!="function";function F(o,m){const h=$(u=>u.gl),i=W(j,R(o)?Object.values(o):o);return l.useLayoutEffect(()=>{m==null||m(i)},[m]),l.useEffect(()=>{if("initTexture"in h){let u=[];Array.isArray(i)?u=i:i instanceof C?u=[i]:R(i)&&(u=Object.values(i)),u.forEach(g=>{g instanceof C&&h.initTexture(g)})}},[h,i]),l.useMemo(()=>{if(R(o)){const u={};let g=0;for(const A in o)u[A]=i[g++];return u}else return i},[o,i])}F.preload=o=>W.preload(j,o);F.clear=o=>W.clear(j,o);function oe(o){return Array.isArray(o)}function G(o=[0,0,0]){return oe(o)?o:o instanceof T||o instanceof S?[o.x,o.y,o.z]:[o,o,o]}const re=l.forwardRef(function({debug:m,depthTest:h=!1,polygonOffsetFactor:i=-10,map:P,mesh:u,children:g,position:A,rotation:c,scale:O,...I},B){const M=l.useRef(null);l.useImperativeHandle(B,()=>M.current);const y=l.useRef(null);return l.useLayoutEffect(()=>{const s=(u==null?void 0:u.current)||M.current.parent,e=M.current;if(!(s instanceof N))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const t={position:new T,rotation:new S,scale:new T(1,1,1)};if(s){D(t,{position:A,scale:O});const r=s.matrixWorld.clone();if(s.matrixWorld.identity(),!c||typeof c=="number"){const a=new v;a.position.copy(t.position),a.lookAt(s.position),typeof c=="number"&&a.rotateZ(c),D(t,{rotation:a.rotation})}else D(t,{rotation:c});return e.geometry=new te(s,t.position,t.rotation,t.scale),y.current&&(D(y.current,t),y.current.traverse(a=>a.raycast=()=>null)),s.matrixWorld=r,()=>{e.geometry.dispose()}}},[u,...G(A),...G(O),...G(c)]),l.createElement("mesh",J({ref:M,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":h,"material-map":P},I),g,m&&l.createElement("mesh",{ref:y},l.createElement("boxGeometry",null),l.createElement("meshNormalMaterial",{wireframe:!0}),l.createElement("axesHelper",null)))}),ne=l.forwardRef(({children:o,enabled:m=!0,speed:h=1,rotationIntensity:i=1,floatIntensity:P=1,floatingRange:u=[-.1,.1],...g},A)=>{const c=l.useRef(null);l.useImperativeHandle(A,()=>c.current,[]);const O=l.useRef(Math.random()*1e4);return K(I=>{var B,M;if(!m||h===0)return;const y=O.current+I.clock.getElapsedTime();c.current.rotation.x=Math.cos(y/4*h)/8*i,c.current.rotation.y=Math.sin(y/4*h)/8*i,c.current.rotation.z=Math.sin(y/4*h)/20*i;let s=Math.sin(y/4*h)/10;s=Q.mapLinear(s,-.1,.1,(B=u==null?void 0:u[0])!==null&&B!==void 0?B:-.1,(M=u==null?void 0:u[1])!==null&&M!==void 0?M:.1),c.current.position.y=s*P,c.current.updateMatrix()}),l.createElement("group",g,l.createElement("group",{ref:c,matrixAutoUpdate:!1},o))}),ae=o=>{const[m]=F([o.imgUrl]);return x.createElement(ne,{speed:1.75,rotationIntensity:.2,floatIntensity:.2},x.createElement("mesh",{scale:2.75},x.createElement("icosahedronGeometry",{args:[1,1]}),o.isMobile?x.createElement("meshBasicMaterial",{color:"#fff8eb",roughness:.5,metalness:.1}):x.createElement("meshLambertMaterial",{color:"#fff8eb",roughness:.5,metalness:.1,clipShadows:!0}),x.createElement(re,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:m,opacity:.9})))},ie=({icon:o})=>{const[m,h]=l.useState(!1);return l.useEffect(()=>{const i=window.innerWidth;h(i<=500)},[]),x.createElement(Y,{frameloop:"demand",dpr:[1,m?1:2],gl:{preserveDrawingBuffer:!0}},x.createElement(l.Suspense,{fallback:x.createElement(V,null)},!m&&x.createElement(x.Fragment,null,x.createElement("ambientLight",{intensity:1.25}),x.createElement("directionalLight",{position:[0,0,.03]})),x.createElement(ee,{enableZoom:!1,enablePan:!1,minAzimuthAngle:-Math.PI/4,maxAzimuthAngle:Math.PI/4,minPolarAngle:Math.PI/2-Math.PI/18,maxPolarAngle:Math.PI/2+Math.PI/18,enableDamping:!0,dampingFactor:.05,target:[0,0,0]}),o&&x.createElement(ae,{imgUrl:o,isMobile:m})))};export{ie as default};
