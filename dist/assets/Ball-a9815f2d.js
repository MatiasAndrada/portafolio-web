import{N as X,l as z,k as L,av as B,ao as Z,an as j,q as T,r as a,U as $,aw as H,ax as R,O as q,ay as J,az as K,aA as Q,a0 as Y,R as w,ar as v,as as V}from"./index-e9da750b.js";import{O as tt}from"./OrbitControls-b1598170.js";class et extends X{constructor(c,f,p,x){super();const h=[],A=[],D=[],d=new z,M=new L;M.makeRotationFromEuler(p),M.setPosition(f);const k=new L;k.copy(M).invert(),E(),this.setAttribute("position",new B(h,3)),this.setAttribute("normal",new B(A,3)),this.setAttribute("uv",new B(D,2));function E(){let t,e=[];const n=new z,s=new z;if(c.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const r=c.geometry,O=r.attributes.position,b=r.attributes.normal;if(r.index!==null){const i=r.index;for(t=0;t<i.count;t++)n.fromBufferAttribute(O,i.getX(t)),s.fromBufferAttribute(b,i.getX(t)),P(e,n,s)}else for(t=0;t<O.count;t++)n.fromBufferAttribute(O,t),s.fromBufferAttribute(b,t),P(e,n,s);for(e=l(e,d.set(1,0,0)),e=l(e,d.set(-1,0,0)),e=l(e,d.set(0,1,0)),e=l(e,d.set(0,-1,0)),e=l(e,d.set(0,0,1)),e=l(e,d.set(0,0,-1)),t=0;t<e.length;t++){const i=e[t];D.push(.5+i.position.x/x.x,.5+i.position.y/x.y),i.position.applyMatrix4(M),h.push(i.position.x,i.position.y,i.position.z),A.push(i.normal.x,i.normal.y,i.normal.z)}}function P(t,e,n){e.applyMatrix4(c.matrixWorld),e.applyMatrix4(k),n.transformDirection(c.matrixWorld),t.push(new U(e.clone(),n.clone()))}function l(t,e){const n=[],s=.5*Math.abs(x.dot(e));for(let r=0;r<t.length;r+=3){let O,b,i,F=0,u,y,g,I;const S=t[r+0].position.dot(e)-s,_=t[r+1].position.dot(e)-s,N=t[r+2].position.dot(e)-s;switch(O=S>0,b=_>0,i=N>0,F=(O?1:0)+(b?1:0)+(i?1:0),F){case 0:{n.push(t[r]),n.push(t[r+1]),n.push(t[r+2]);break}case 1:{if(O&&(u=t[r+1],y=t[r+2],g=m(t[r],u,e,s),I=m(t[r],y,e,s)),b){u=t[r],y=t[r+2],g=m(t[r+1],u,e,s),I=m(t[r+1],y,e,s),n.push(g),n.push(y.clone()),n.push(u.clone()),n.push(y.clone()),n.push(g.clone()),n.push(I);break}i&&(u=t[r],y=t[r+1],g=m(t[r+2],u,e,s),I=m(t[r+2],y,e,s)),n.push(u.clone()),n.push(y.clone()),n.push(g),n.push(I),n.push(g.clone()),n.push(y.clone());break}case 2:{O||(u=t[r].clone(),y=m(u,t[r+1],e,s),g=m(u,t[r+2],e,s),n.push(u),n.push(y),n.push(g)),b||(u=t[r+1].clone(),y=m(u,t[r+2],e,s),g=m(u,t[r],e,s),n.push(u),n.push(y),n.push(g)),i||(u=t[r+2].clone(),y=m(u,t[r],e,s),g=m(u,t[r+1],e,s),n.push(u),n.push(y),n.push(g));break}}}return n}function m(t,e,n,s){const r=t.position.dot(n)-s,O=e.position.dot(n)-s,b=r/(r-O);return new U(new z(t.position.x+b*(e.position.x-t.position.x),t.position.y+b*(e.position.y-t.position.y),t.position.z+b*(e.position.z-t.position.z)),new z(t.normal.x+b*(e.normal.x-t.normal.x),t.normal.y+b*(e.normal.y-t.normal.y),t.normal.z+b*(e.normal.z-t.normal.z)))}}}class U{constructor(c,f){this.position=c,this.normal=f}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const C=o=>o===Object(o)&&!Array.isArray(o)&&typeof o!="function";function W(o,c){const f=Z(x=>x.gl),p=j(T,C(o)?Object.values(o):o);if(a.useLayoutEffect(()=>{c==null||c(p)},[c]),a.useEffect(()=>{(Array.isArray(p)?p:[p]).forEach(f.initTexture)},[f,p]),C(o)){const x=Object.keys(o),h={};return x.forEach(A=>Object.assign(h,{[A]:p[x.indexOf(A)]})),h}else return p}W.preload=o=>j.preload(T,o);W.clear=o=>j.clear(T,o);function ot(o){return Array.isArray(o)}function G(o=[0,0,0]){return ot(o)?o:o instanceof z||o instanceof H?[o.x,o.y,o.z]:[o,o,o]}const rt=a.forwardRef(function({debug:c,mesh:f,children:p,position:x,rotation:h,scale:A,...D},d){const M=a.useRef(null);a.useImperativeHandle(d,()=>M.current);const k=a.useRef(null);return a.useLayoutEffect(()=>{const E=(f==null?void 0:f.current)||M.current.parent,P=M.current;if(!(E instanceof $))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const l={position:new z,rotation:new H,scale:new z(1,1,1)};if(E){R(l,{position:x,scale:A});const m=E.matrixWorld.clone();if(E.matrixWorld.identity(),!h||typeof h=="number"){const t=new q;t.position.copy(l.position),t.lookAt(E.position),typeof h=="number"&&t.rotateZ(h),R(l,{rotation:t.rotation})}else R(l,{rotation:h});return P.geometry=new et(E,l.position,l.rotation,l.scale),k.current&&R(k.current,l),E.matrixWorld=m,()=>{P.geometry.dispose()}}},[f,...G(x),...G(A),...G(h)]),a.createElement("mesh",{ref:M},p||a.createElement("meshStandardMaterial",J({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},D)),c&&a.createElement("mesh",{ref:k},a.createElement("boxGeometry",null),a.createElement("meshNormalMaterial",{wireframe:!0}),a.createElement("axesHelper",null)))}),nt=a.forwardRef(({children:o,enabled:c=!0,speed:f=1,rotationIntensity:p=1,floatIntensity:x=1,floatingRange:h=[-.1,.1],...A},D)=>{const d=a.useRef(null),M=a.useRef(Math.random()*1e4);return K(k=>{var E,P;if(!c||f===0)return;const l=M.current+k.clock.getElapsedTime();d.current.rotation.x=Math.cos(l/4*f)/8*p,d.current.rotation.y=Math.sin(l/4*f)/8*p,d.current.rotation.z=Math.sin(l/4*f)/20*p;let m=Math.sin(l/4*f)/10;m=Y.mapLinear(m,-.1,.1,(E=h==null?void 0:h[0])!==null&&E!==void 0?E:-.1,(P=h==null?void 0:h[1])!==null&&P!==void 0?P:.1),d.current.position.y=m*x,d.current.updateMatrix()}),a.createElement("group",A,a.createElement("group",{ref:Q([d,D]),matrixAutoUpdate:!1},o))}),st=o=>{const[c]=W([o.imgUrl]);return w.createElement(nt,{speed:1.75,rotationIntensity:.2,floatIntensity:.2},w.createElement("ambientLight",{intensity:.25}),w.createElement("directionalLight",{position:[0,0,.05]}),w.createElement("mesh",{scale:2.75},w.createElement("icosahedronGeometry",{args:[1,1]}),w.createElement("meshStandardMaterial",{color:"#fff8eb",roughness:.5,metalness:.1}),w.createElement(rt,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:c,opacity:.9})))},ut=({icon:o})=>{const[c,f]=a.useState(!1);return a.useEffect(()=>{const p=window.innerWidth;f(p<=500)},[]),w.createElement(v,{frameloop:"demand",dpr:[1,c?1:2],gl:{preserveDrawingBuffer:!0}},w.createElement(a.Suspense,{fallback:w.createElement(V,null)},w.createElement(tt,{enableZoom:!1,enablePan:!1,minAzimuthAngle:-Math.PI/4,maxAzimuthAngle:Math.PI/4,minPolarAngle:Math.PI/2-Math.PI/18,maxPolarAngle:Math.PI/2+Math.PI/18,enableDamping:!0,dampingFactor:.05,target:[0,0,0]}),o&&w.createElement(st,{imgUrl:o})))};export{ut as default};
